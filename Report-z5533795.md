# COMP6841 Project Report

Author: Henrick Lin (z5533795)

## Results

In this project, I developed three practical challenges focused on SQL injection (SQLi) and Cross-Site Scripting (XSS) vulnerabilities. These challenges were designed to provide a structured learning experience with hints and progressive difficulty. Key achievements include:

1. **Easy SQLi Challenge**: Simulated a basic login page vulnerable to SQLi, allowing users to bypass authentication using payloads like `' OR 1=1--`. This challenge demonstrated the dangers of insecure query concatenation.

2. **Advanced SQLi Challenge**: Introduced a grade-checking interface protected by a keyword-based WAF. Users had to bypass filters using techniques like mixed-case keywords (`UnIoN`) and encoded whitespace (`/**/`). This challenge emphasized column count determination, UNION-based exploitation, and database exploitation.

3. **Stored XSS Challenge**: Created a message board where users could inject malicious scripts. I implemented an admin bot (using puppeteer) to trigger XSS payloads and steal cookies. This highlighted the risks of rendering unsanitized user input in HTML and using `dangerouslySetInnerHTML` in React.

4. **Deployment**: Successfully deployed the frontend on Vercel and the backend on AWS EC2, configuring Nginx and SSL for avoiding mixed content issues and secure communication. The project is accessible at [https://ctf.cuinspace.tech/](https://ctf.cuinspace.tech/).

I am particularly proud of the realism and educational value of the Advanced SQLi and Stored XSS challenges, which required creative problem-solving and attention to detail. Detailed Write-ups can be found in project deliverables.

## What I did

My time was divided into research, implementation, testing, and deployment:

1. **Research**: Studied SQLi bypass techniques (OWASP guidelines: [https://owasp.org/www-community/attacks/SQL_Injection_Bypassing_WAF](https://owasp.org/www-community/attacks/SQL_Injection_Bypassing_WAF)) and XSS payload execution in React. This informed the design of the WAF and the behavior of `dangerouslySetInnerHTML`.

2. **Implementation**: Built the challenges using React (frontend), Express.js (backend), and Supabase (PostgreSQL). Key tasks included:
   - Designing the WAF (keyword and space filtering) for the Advanced SQLi challenge.
   - Simulating admin bot interactions for the XSS challenge.

3. **Testing**: Validated each challenge by attempting exploits. For example, I tested various SQLi payloads to ensure the WAF was bypassable but not trivial.

4. **Refining Hints**: Refined the hints to be more progressive and less straight-forward.

5. **Deployment**: Configured Nginx as a reverse proxy and secured the backend with HTTPS using Certbot. This resolved mixed content issues between the frontend (HTTPS) and backend (HTTP). Researching puppeteer documentation and debugging puppeteer on EC2.

## How I was challenged

This project pushed my technical and problem-solving skills in several ways:

1. **Technical Hurdles**:
   - **WAF Bypass**: Designing a realistic yet bypassable WAF required extensive testing and research. I learned the importance of case sensitivity and whitespace encoding in SQLi attacks.
   - **XSS Execution**: Understanding why `<script>` tags failed in `dangerouslySetInnerHTML` but `<img onerror>` worked was a key learning point. This led me to explore Reactâ€™s rendering behavior and alternative payloads.
   - **Deployment**:
    - Configuring Nginx and SSL was initially daunting, but I gained confidence by following documentation and troubleshooting errors.
    - Debugging puppeteer on EC2 was challenging. I learned the use of `--no-sandbox` and `headless: true` in headless servers.

2. **Personal Growth**:
   - **SQLi**: I learned the use of `CHR()`-based payloads to bypass the WAF that filters out mixed-case keywords.
   - **XSS**: I learned the use of `dangerouslySetInnerHTML` in React and reviewed the use of `document.location` to redirect the browser to a different page.
   - **Deployment**: I had an hands-on experience of deploying a frontend (Vercel) and backend (AWS EC2) separately, and also the use of Nginx as a reverse proxy.

3. **Lessons Learned**:
   - **Realism vs. Pedagogy**: Striking the right balance between realistic vulnerabilities and guided learning is challenging.
   - **Tool Usage**: Becoming proficient with Puppeteer and Nginx opened new possibilities for simulating real-world attacks and deploying secure applications.

If I were to repeat this project, I would invest more time in designing more realistic challenges and refining the hints.

## Appendix

1. **GitHub Repository**: [https://github.com/CUinspace233/SQLi-and-XSS-CTF](https://github.com/CUinspace233/SQLi-and-XSS-CTF)
2. **Project URL**: [https://ctf.cuinspace.tech/](https://ctf.cuinspace.tech/) (Good Faith Policy!)
3. **References**:
   - OWASP SQLi Bypassing WAF: [https://owasp.org/www-community/attacks/SQL_Injection_Bypassing_WAF](https://owasp.org/www-community/attacks/SQL_Injection_Bypassing_WAF)
   - Puppeteer Documentation: [https://pptr.dev/guides/browser-management](https://pptr.dev/guides/browser-management)
   - React Issue #20446: [https://github.com/facebook/react/issues/20446](https://github.com/facebook/react/issues/20446)
